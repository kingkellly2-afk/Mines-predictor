<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mines Predictor</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-900 text-white p-4">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold text-center mb-4">Mines Predictor</h1>

    <!-- Input -->
    <div class="flex flex-col sm:flex-row gap-2 mb-4">
      <input id="seed" type="text" placeholder="Enter server seed"
        class="flex-1 p-2 rounded bg-gray-800 border border-gray-700">
      <input id="mines" type="number" placeholder="Mines" min="1" max="24"
        class="w-24 p-2 rounded bg-gray-800 border border-gray-700">
      <button onclick="runSimulation()"
        class="bg-blue-600 hover:bg-blue-500 px-4 py-2 rounded">Simulate</button>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto mb-6">
      <table class="table-auto w-full text-sm border border-gray-700">
        <thead class="bg-gray-800">
          <tr>
            <th class="p-2 border border-gray-700">Mines</th>
            <th class="p-2 border border-gray-700">Games</th>
            <th class="p-2 border border-gray-700">Wins</th>
            <th class="p-2 border border-gray-700">Losses</th>
            <th class="p-2 border border-gray-700">Win Rate %</th>
            <th class="p-2 border border-gray-700">Avg Safe Tiles</th>
          </tr>
        </thead>
        <tbody id="resultsTable"></tbody>
      </table>
    </div>

    <!-- Chart -->
    <canvas id="resultsChart" height="150"></canvas>
  </div>

<script>
function simulate(seed, mineCount, games = 1000) {
  let wins = 0;
  let losses = 0;
  let safeTilesClicked = 0;
  const totalTiles = 25;
  const safeTiles = totalTiles - mineCount;

  for (let i = 0; i < games; i++) {
    let clickedSafe = Math.floor(Math.random() * safeTiles);
    safeTilesClicked += clickedSafe;
    if (clickedSafe === safeTiles) wins++;
    else losses++;
  }
  return {
    mines: mineCount,
    games,
    wins,
    losses,
    winRate: (wins / games) * 100,
    avgSafe: safeTilesClicked / games,
    safeRatio: (safeTiles / totalTiles) * 100,
    mineRatio: (mineCount / totalTiles) * 100
  };
}

function runSimulation() {
  const seed = document.getElementById("seed").value || "test";
  const mineInput = parseInt(document.getElementById("mines").value) || 3;
  const results = [];
  for (let m = 1; m <= mineInput; m++) {
    results.push(simulate(seed, m, 1000));
  }
  renderTable(results);
  renderChart(results);
}

function renderTable(data) {
  const tbody = document.getElementById("resultsTable");
  tbody.innerHTML = "";
  data.forEach(r => {
    tbody.innerHTML += `
      <tr class="bg-gray-800 border border-gray-700">
        <td class="p-2 border border-gray-700">${r.mines}</td>
        <td class="p-2 border border-gray-700">${r.games}</td>
        <td class="p-2 border border-gray-700">${r.wins}</td>
        <td class="p-2 border border-gray-700">${r.losses}</td>
        <td class="p-2 border border-gray-700">${r.winRate.toFixed(2)}</td>
        <td class="p-2 border border-gray-700">${r.avgSafe.toFixed(2)}</td>
      </tr>
    `;
  });
}

let chartInstance;
function renderChart(data) {
  const ctx = document.getElementById("resultsChart").getContext("2d");
  if (chartInstance) chartInstance.destroy();
  chartInstance = new Chart(ctx, {
    type: "bar",
    data: {
      labels: data.map(r => r.mines + " mines"),
      datasets: [
        {
          label: "✅ Safe Tiles %",
          data: data.map(r => r.safeRatio),
          backgroundColor: "rgba(34,197,94,0.7)", // green
          stack: "tiles"
        },
        {
          label: "❌ Mines %",
          data: data.map(r => r.mineRatio),
          backgroundColor: "rgba(239,68,68,0.7)", // red
          stack: "tiles"
        },
        {
          type: "line",
          label: "Win Rate %",
          data: data.map(r => r.winRate),
          borderColor: "rgba(59,130,246,1)",
          backgroundColor: "rgba(59,130,246,0.5)",
          yAxisID: "y1"
        }
      ]
    },
    options: {
      responsive: true,
      interaction: { mode: "index", intersect: false },
      scales: {
        y: {
          beginAtZero: true,
          max: 100,
          position: "left",
          title: { display: true, text: "Safe/Mine %" }
        },
        y1: {
          beginAtZero: true,
          max: 100,
          position: "right",
          grid: { drawOnChartArea: false },
          title: { display: true, text: "Win Rate %" }
        }
      }
    }
  });
}
</script>
</body>
</html>
